//Base64 Encoding of cql
cat NRC_Assessment.cql | base64 | tr -d '\n'
cat DOAC_Prescription.cql

//Paste resultant encoded data into Library the: Post to server:
///curl -sH "Content-Type: application/fhir+json" -d @library.json "http://localhost:8080/fhir/Library"
{
    "resourceType": "Library",
    "url": "urn:uuid:50f4c7de-2011-4208-8e60-ecc0d1005e08",
    "status": "active",
    "type" : {
      "coding" : [
        {
          "system": "http://terminology.hl7.org/CodeSystem/library-type",
          "code" : "logic-library"
        }
      ]
    },
    "content": [
      {
        "contentType": "text/cql",
        "data": "bGlicmFyeSBFZG94YWJhbl9QcmVzY3JpcHRpb25fdjEKdXNpbmcgRkhJUiB2ZXJzaW9uICc0LjAuMCcKaW5jbHVkZSBGSElSSGVscGVycyB2ZXJzaW9uICc0LjAuMCcKCmNvZGVzeXN0ZW0gIlNOT01FRCI6ICdodHRwOi8vc25vbWVkLmluZm8vc2N0Jwpjb2Rlc3lzdGVtICJJQ0QxMCI6ICdodHRwOi8vaWNkMTAub3JnJwpjb2Rlc3lzdGVtICJMT0lOQyI6ICdodHRwOi8vbG9pbmMub3JnJwoKY29udGV4dCBQYXRpZW50CgovL0RlZmluaW5nIEluaXRpYWwgUG9wdWxhdGlvbiBEaWFnb25haXNlZCB3aXRoIEF0cmlhbCBGaWJyaWxhdGlvbiBhbmQgYWdlLgpkZWZpbmUgSW5pdGlhbFBvcHVsYXRpb246CkFnZUluWWVhcnMoKSA+PSAyMCBhbmQgQWdlSW5ZZWFycygpIDw9IDgwIGFuZApleGlzdHMgKFtDb25kaXRpb246IENvZGUgJzQ5NDM2MDA0JyBmcm9tIFNOT01FRF0pCgovL0RlZmluZSBQb3B1bGF0aW9uIGZvciBFZG94YWJhbiA2MG1nIDEgdGFiIHBlciBkYXkgcHJlc2NyaXRwaW9uLgpkZWZpbmUgU2l4dHlfbWdfRWRveGFiYW5fUHJlc2NyaXB0aW9uOgpleGlzdHMgSW5pdGlhbFBvcHVsYXRpb24gYW5kCmV4aXN0cyAoW09ic2VydmF0aW9uOiBDb2RlICczNTU5MS03JyBmcm9tIExPSU5DXSBPIHdoZXJlIE8udmFsdWUgYXMgUXVhbnRpdHkgPj01MCAnbUwvbWluJyBhbmQgTy52YWx1ZSBhcyBRdWFudGl0eSA8PSA5NSAnbUwvbWluJykKCgovL0RlZmluZSBQb3B1bGF0aW9uIHRvIGV4Y2x1ZGUgZnJvbSBlZG94YWJhbiA2MG1nIHByZXNjcmlwdGlvbiBidXQgaW5jbHVkZSBpbiBlZG94YWJhbiAzMG1nIDEgdGFibGV0IHBlciBkYXkgcHJlc2NyaXB0aW9uCmRlZmluZSBUaGlydHlfbWdfRWRveGFiYW5fUHJlc2NyaXB0aW9uOgpleGlzdHMgSW5pdGlhbFBvcHVsYXRpb24gYW5kCmV4aXN0cyAoW09ic2VydmF0aW9uOiBDb2RlICczNTU5MS03JyBmcm9tIExPSU5DXSBPIHdoZXJlIE8udmFsdWUgYXMgUXVhbnRpdHkgPj0gMzAgJ21ML21pbicgYW5kIE8udmFsdWUgYXMgUXVhbnRpdHkgPD01MCAnbUwvbWluJykKCi8vRGVmaW5lIFBvcHVsYXRpb24gdG8gZXhjbHVkZSBmcm9tIEVkb3hhYmFuIFByZXNjcmlwdGlvbgpkZWZpbmUgTk9fRWRveGFiYW5fUHJlc2NyaXB0aW9uOgpub3QgZXhpc3RzICJTaXh0eV9tZ19FZG94YWJhbl9QcmVzY3JpcHRpb24iIG9yCm5vdCBleGlzdHMgIlRoaXJ0eV9tZ19FZG94YWJhbl9QcmVzY3JpcHRpb24i"
    }
]
}




//Post the URL OF THE Library into the measure and post the measure to server:
//curl -sH "Content-Type: application/fhir+json" -d @measure.json "http://172.16.19.134:8080/fhir/Measure"

{
    "resourceType": "Measure",
    "url": "urn:uuid:49f4c7de-3320-2012-8e60-ecc0d8803e09",
    "status": "active",
    "library": "urn:uuid:50f4c7de-2011-4208-8e60-ecc0d1005e08",
    "scoring": {
      "coding": [
        {
          "system": "http://terminology.hl7.org/CodeSystem/measure-scoring",
          "code": "cohort"
        }
      ]
    },
    "group": [
      {
        "population": [

              {
            "code": {
              "coding": [
                {
                    "system": "http://terminology.hl7.org/CodeSystem/measure-population",
                    "code": "initial-population"
                }
              ]
            },
            "criteria": {
                "language": "text/cql-identifier",
                "expression": "Sixty_mg_Edoxaban_Prescription"
            }
          }
        ]
      }
    ]
}

//Verify measure.
//curl -s 'http://localhost:8080/fhir/Measure/$evaluate-measure?measure=urn:uuid:49f4c7de-3320-4208-8e60-ecc0d8824e08&periodStart=2000&periodEnd=2030'


// Then create a report for the measure. Remember to use the measure URL in the posting..

//curl -sd '{"resourceType": "Parameters", "parameter": [{"name": "periodStart", "valueDate": "2000"}, {"name": "periodEnd", "valueDate": "2030"}, {"name": "measure", "valueString": "urn:uuid:49f4c7de-3320-4208-8e60-ecc0d8824e08"}, {"name": "reportType", "valueCode": "subject-list"}]}' -H "Content-Type: application/fhir+json" 'http://localhost:8080/fhir/Measure/$evaluate-measure'

// List Patients in the Population based on the List_id:
//curl -s 'http://localhost:8080/fhir/List?_id=C6QKSKQ2V7DAF3X6&_include=List:item'